
<% layout( 'm_layout' ) -%>

<div class="jumbotron">
	<div class="container">
  <h2>Module Search</h2>
  <h3>Freitextsuche</h3>
	<input id="fulltext-search" class="mbase-search-container" type="text">
	<div class="buttons">
     <button id="submitfulltextsearch" type="submit">suchen</button>  
  </div>


	<h3>Suche nach Schl√ºsselworten</h3>
	<select id="tag-search" class="js-example-basic-multiple mbase-search-container" multiple="multiple"></select>
	<div class="buttons">
		 <button id="submittagserach" type="submit">suchen</button>  
	</div>
  </div>
</div>
<div class="container">

	<h3>Suchergebnisse</h3>
	<div id="search-results"></div>
		<ul id="result-list"></ul>
</div>

<script> 
$(document).ready(function() {
	//$.fn.select2.defaults.set("theme", "classic");
  $(".js-example-basic-multiple").select2();
  
  
  $('#submitfulltextsearch').click(function(){
  	var query = $('#fulltext-search').val(); 
  	console.log( 'fulltext-search query: ' + query );
  	$.get('/modules/search/fulltext/'+query, function(data){ 
  		$('#result-list').empty();
  		for(var i in data){
  			if(data.hasOwnProperty(i)){
  				var li = $('<li></li>').appendTo('#result-list');
  				var link = $('<a>')
  					.text( data[i].modultitel )
  					.attr('href','/modules/view/'+ data[i]._id )
  					.appendTo(li)
  					;
  			}
  		}
  	})
  });
  
  $('#submittagserach').click(function(){
  	var query = $('#tag-search').val(); 
  	console.log( 'tag-search query: ' + query );
  	$.get('/modules/search/tags/'+query, function(data){ 
  		$('#result-list').empty();
  		for(var i in data){
  			if(data.hasOwnProperty(i)){
  				var li = $('<li></li>').appendTo('#result-list');
  				var link = $('<a>')
  					.text( data[i].modultitel )
  					.attr('href','/modules/view/'+ data[i]._id )
  					.appendTo(li)
  					;
  			}
  		}
  	})
  });
  
  
  // fill tag schema to select2
  $.get('/modules/tag-schema', function(data){
  	for(var group in data){
  		if( data.hasOwnProperty(group) ){
  			var gr = $('<optgroup></optgroup>')
  				.attr('label', group)
  				.appendTo( '#tag-search' );
  				;	
  			for(var i = 0; i < data[group].length; i++){
  				$('<option>')
  					.attr('value', data[group][i] )//data[group][i].replace(\\ \g, '')
  					.text( data[group][i] )
  					.appendTo( gr )
  					;
  			}
  				
  		}
  	}
  });
  
  
  
});

</script>


